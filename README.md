# Portfolio Skeleton

[Live demo][demo]

## Installation

First fork this repo (not clone!) and install the deps:

```
$ git clone git@github.com:<your-github-username>/portfolio-skeleton.git
$ cd portfolio-skeleton
$ npm install
```

The in two separate terminal tabs:

```
$ npm run dev:site
$ npm run dev:client
```

**Note**: nodemon is used to watch file changes for the `dev:site task`, and does not trigger on file delete. Just restart the task manually in case.

## Development

The code has the following structure:

```
/assets
    ...
/data
    ...
/src
    client
        css
            style.css
        index.js
    views
        layouts
        partials
        ...
```

- `assets`: contains static fields, served from `/`;
- `data`: contains the markdown files for all the pages;
- `src/client`: contains the css file and the frontend js;
- `src/views`: contains the Handlebars files (views, layout and partials).

### Markdown files

They look like

```yaml
---
title: About Me
description: I am xyz, developer and innovator
slug: about
---

## Education

Lorem ipsum dolor sit amet, **consectetur adipiscing elit**. Praesent eget aliquam erat. Aenean accumsan auctor consectetur. Nam rutrum accumsan mauris nec convallis. Donec tellus dolor, consectetur vel faucibus sit amet, vestibulum vitae ex. Phasellus id quam lectus. Ut ornare ex in nulla vestibulum, sed sagittis ante blandit. Aenean libero libero, feugiat sit amet venenatis sit amet, luctus non felis.

![Myself](https://source.unsplash.com/random/640x360?people,afternoon)

_This is me!_
```

The block between `---` signs is called [front matter][npm:gray-matter], and contains values in the [YAML][yaml] format, that will be available as is inside the Handlebars templates:

```handlebars
<title>{{ title }}</title>
<p>{{ description }}</p>
<a href="/{{ slug }}">...</a>
```

The text below the front matter is redacted in [markdown][markdown] and is available as parsed HTML in the `content` variable:

```handlebars
<section>
    <h2>{{ title }}</h2>
    {{{ content }}}
</section>
```

(notice the triple curly!)

### Additional configuration

Further data can be stored inside `config.json`, and it will be available in the templates inside the `config` variable:

```handlebars
<p>Write me at <a href="mailto:{{config.contact.email}}">my e-mail address</a></p>
```

## Build and deploy

Running:

```
$ npm run build
```

Will generate the complete website inside the `./dist` folder.

A convenient way of deploying your website is to set up an app at [netlify][netlify]. Just register via github and add a new site from the dashboard.

You can just drag and drop your `dist` folder inside the deploys section, and your contents will be available at the website URL!

If you want to automate the deploy process, you can link your local folder to your netlify project:

```
$ npx netlify link
```

Follow the instructions, login from the webpage and choose the right project from the list in the terminal.

Then just do:

```
$ npm run build
$ npm run deploy
```

Remember to build every time to upload the updated version of your website.

## How does it work

There are two main steps in static website generation: data collection and page rendering. It's useful that they are separated, because it gives you a chance to refine / edit the data before passing it to the render function, e.g.:

```js
const data = await loadData();
const output = await render(data.filter(x => !x.draft));
```

This will render just the pages that don't have a `draft` property set to true.

### Loading data

In detail, `loadData` retrieves all the `.md` files in the data folder (by default `./data`) with the [globby][npm:globby] package, load their contents and parses it with [gray-matter][npm:gray-matter].

The following file:

```yaml
---
title: About Me
description: I am xyz, developer and innovator
slug: about
---
some content
```

will result in the following object:

```js
{
    template: "page",
    title: "About Me",
    description: "I am xyz, developer and innovator",
    slug: "about",
    content: "some content"
}
```

The `template` property refers to the used Handlebars template. If the property is not specified in the front matter, `"page"` will be used as default.

The **slug** is the _unique identifying part_ of a web address, typically at the end of the URL. Since the title may contain uppercase letters, spaces or other non URL friendly characters, the slug offers a safe alternative, e.g. `blog/this-is-my-first-post`, `contact-me`, `herr-mueller`.

### Rendering pages

The express instance (`app`) has a convenience method called `render`, that does what `response.render()` does, minus the HTTP communication part, i.e. it returns the HTML generated by Handlebars.

Saving that to an HTML file inside the `./dist` folder seals the deal!

This step is exposed via the `render` function of the `lib.js` file. The second parameter passed to `render` will be be available in all the templates, see:

```js
const data = await loadData();

const projects = data
    .filter((x) => x.slug.startsWith("projects/"))
    .sort((a, b) => a.order - b.order);
const featuredProjects = projects.filter((x) => x.featured).reverse();

const output = await render(data, { projects, featuredProjects });
```

In this case `projects` contains all the single projects pages, and `featuredProjects` those marked as `featured` so they appear on the homepage like:

```handlebars
<section class="projects-section column">
    <h2 data-aos="fade-right">{{sections.projects.title}}</h2>
    <p data-aos="fade-right">{{sections.projects.description}}</p>
    {{> projectsList projects=featuredProjects}}
    <p>
        <a href="/projects">{{sections.projects.see_all}}</a>
    </p>
</section>
```

[demo]: https://portfolio-skeleton.netlify.app/
[markdown]: https://www.markdownguide.org/cheat-sheet/
[yaml]: https://yaml.org/
[npm:gray-matter]: https://www.npmjs.com/package/gray-matter
[npm:globby]: https://www.npmjs.com/package/globby/v/11.1.0
[netlify]: https://app.netlify.com